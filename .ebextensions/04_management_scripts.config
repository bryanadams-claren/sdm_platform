# .ebextensions/04_management_scripts.config
# Make environment variables available to ec2-user

container_commands:
  01_copy_env_for_ec2_user:
    command: |
      #!/bin/bash
      # Copy environment variables to ec2-user home directory with proper export statements
      # Only run if the deployment env file exists (may not exist on worker tier)
      if [ -f /opt/elasticbeanstalk/deployment/env ]; then
        while IFS='=' read -r key value; do
          [[ -z "$key" ]] && continue
          printf "export %s='%s'\n" "$key" "$value"
        done < /opt/elasticbeanstalk/deployment/env > /home/ec2-user/.eb-env
        chmod 644 /home/ec2-user/.eb-env
        chown ec2-user:ec2-user /home/ec2-user/.eb-env
        echo "Created .eb-env file for ec2-user"
      else
        echo "Skipping .eb-env creation - deployment/env file not found (this is normal for worker tier)"
      fi
