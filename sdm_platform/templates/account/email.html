{% extends "base.html" %}

{% load static allauth i18n %}

{% block title %}
  Email Addresses - Claren Health
{% endblock title %}
{% block content %}
  <div class="container mt-5 pt-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body p-5">
            <h2 class="card-title text-center mb-4">{% trans "Email Addresses" %}</h2>
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show"
                     role="alert">
                  {{ message }}
                  <button type="button"
                          class="btn-close"
                          data-bs-dismiss="alert"
                          aria-label="Close"></button>
                </div>
              {% endfor %}
            {% endif %}
            {% if emailaddresses %}
              <p class="text-muted mb-4">{% trans 'The following email addresses are associated with your account:' %}</p>
              {% url 'account_email' as email_url %}
              <form method="post" action="{{ email_url }}" class="mb-4">
                {% csrf_token %}
                <div class="list-group mb-3">
                  {% for radio in emailaddress_radios %}
                    {% with emailaddress=radio.emailaddress %}
                      <label class="list-group-item list-group-item-action d-flex align-items-center">
                        <input class="form-check-input me-3"
                               type="radio"
                               name="email"
                               value="{{ emailaddress.email }}"
                               id="{{ radio.id }}"
                               {% if radio.checked %}checked{% endif %} />
                        <div class="flex-grow-1">
                          <span class="fw-medium">{{ emailaddress.email }}</span>
                          <div class="mt-1">
                            {% if emailaddress.verified %}
                              <span class="badge bg-success">{% translate "Verified" %}</span>
                            {% else %}
                              <span class="badge bg-warning text-dark">{% translate "Unverified" %}</span>
                            {% endif %}
                            {% if emailaddress.primary %}
                              <span class="badge bg-primary">{% translate "Primary" %}</span>
                            {% endif %}
                          </div>
                        </div>
                      </label>
                    {% endwith %}
                  {% endfor %}
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <button type="submit" name="action_primary" class="btn btn-primary">{% trans 'Make Primary' %}</button>
                  <button type="submit" name="action_send" class="btn btn-outline-secondary">{% trans 'Re-send Verification' %}</button>
                  <button type="submit" name="action_remove" class="btn btn-outline-danger">{% trans 'Remove' %}</button>
                </div>
              </form>
            {% else %}
              <div class="alert alert-warning" role="alert">
                <strong>{% trans "Warning:" %}</strong>
                {% trans "You currently do not have any email address set up. You should really add an email address so you can receive notifications, reset your password, etc." %}
              </div>
            {% endif %}
            {% if can_add_email %}
              <hr class="my-4" />
              <h3 class="h5 mb-3">{% trans "Add Email Address" %}</h3>
              {% url 'account_email' as action_url %}
              <form method="post" action="{{ action_url }}">
                {% csrf_token %}
                <div class="mb-3">
                  <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
                  <input type="email"
                         name="{{ form.email.name }}"
                         class="form-control"
                         id="{{ form.email.id_for_label }}"
                         placeholder="Enter email address"
                         {% if form.email.value %}value="{{ form.email.value }}"{% endif %}
                         required />
                  {% if form.email.errors %}<div class="invalid-feedback d-block">{{ form.email.errors }}</div>{% endif %}
                  {% if form.email.help_text %}<div class="form-text">{{ form.email.help_text }}</div>{% endif %}
                </div>
                <button type="submit" name="action_add" class="btn btn-success">{% trans "Add Email" %}</button>
              </form>
            {% endif %}
            <div class="text-center mt-4">
              <a href="{% url 'users:detail' user.pk %}" class="text-decoration-none">
                <i class="bi bi-arrow-left"></i> Back to Profile
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
{% block extra_body %}
  <script src="{% static 'account/js/account.js' %}"></script>
  <script src="{% static 'account/js/onload.js' %}"></script>
  <script data-allauth-onload="allauth.account.forms.manageEmailForm" type="application/json">
    {
      "i18n": {
        "confirmDelete": "{% trans 'Do you really want to remove the selected email address?' %}"
      }
    }
  </script>
{% endblock extra_body %}
